---
title: "Archive"
format: html
---
```{r setup}
#| include: false

source("r scripts/create-tables.R")
source("r scripts/create-navbar.R")


```

::: {.callout-note icon="false"}
This is an archive of everything published by Uncommon Sense Project. You can filter by category and search by text.
:::

---

```{r echo=FALSE}
#| label: searchable-archive

suppressWarnings(library(DT))
library(dplyr)
library(purrr)
suppressWarnings(library(markdown))


archive %>%
  select(-Right, -SummaryMD) %>%
  rename(Summary = SummaryHTML) %>%
  filter(!grepl("Example", Title)) %>%
  filter(Publish == TRUE) %>% select(-Publish) %>%
  mutate(
    Title = paste0("[", Title, "]", "(", Link, ")"),
    # Convert markdown to HTML fragments so links, bold, etc. render correctly
    Title = map_chr(Title, ~markdownToHTML(text = .x, fragment.only = TRUE))
  ) %>%
  select(-Link) %>%
  datatable(
    rownames = FALSE,
    escape = FALSE,  # <- key: allows HTML output from markdown to render properly
   #extensions = c('Buttons', 'Select'),
    options = list(
      # --- Interface layout: buttons, filter row, table, pagination
    dom = '
    <"top"
       <"d-flex justify-content-between align-items-center"
          <"category-filter">
          f
       >
    >
    rt
    <"bottom d-grid w-100"
       <"bottom-center text-center"
          <"d-flex flex-column align-items-center justify-content-center"
             i
             l
          >
       >
       <"bottom-right d-flex justify-content-end"
          p
       >
    >',
    buttons = c('copy', 'csv'),
      pageLength = 25,
      autoWidth = TRUE,
      buttons = list(
        list(extend = 'copy', text = 'Copy'),
        list(extend = 'csv', text = 'Download CSV')
      ),
      
      columnDefs = list(
        list(targets = "_all", className = "dt-left"),
        list(targets = c(1, 2), type = "html"), #Make HTML columns sort by text content
        list(targets = 0, visible = FALSE) #hide Category column (index 3 â€” 0-based indexing)
      ),
      
      # --- Search settings
      search = list(
        regex = TRUE,  # allow regex search
        smart = TRUE,  # improved word-based search
        caseInsensitive = TRUE
      ),
      
      # --- Filter UI for specific columns (dropdown)
      initComplete = JS(
        "function(settings, json) {
           // Example: add a dropdown filter for 'Category' column (index 3)
           var column = this.api().column(0);
          var select = $('<select><option value=\"\">All Categories</option></select>')
            .appendTo($('.category-filter').empty())  // <- place filter above table
            .on('change', function() {
              var val = $.fn.dataTable.util.escapeRegex($(this).val());
              column.search(val ? '^'+val+'$' : '', true, false).draw();
            });
           column.data().unique().sort().each(function(d) {
             select.append('<option value=\"'+d+'\">'+d+'</option>')
           });
         }"
      )
    )
  )

```
